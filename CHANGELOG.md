# Project Change Log

本项目所有的开发进度、功能更新及架构变动均记录于此。

---

## [Unreleased] 早期开发阶段

- **修改人：** 核心团队
- **修改类型：** 功能新增与重构
- **涉及文件：** 核心功能模块、GUI 模块

**具体内容：**
- **交互与批量化**：新增交互式模式（图形界面选择文件）和批量处理模式（支持文件夹处理）。
- **颗粒标注**：添加了颗粒标注功能，实现在分割图上自动添加颗粒编号和面积标注。
- **比例尺模块**：增加了比例尺检测模块，支持自动识别图像比例尺并计算比例因子。
- **架构重构**：重构代码为模块化结构，改进了比例尺检测算法的精确度和批量处理的日志输出。
- **修复**：修复了特定环境下 YOLO 模型加载失败以及比例尺缺失时计算不正确的问题。

---

## [1.0.0] - 2026-01-07

- **修改人：** 核心团队
- **修改类型：** 初始版本发布
- **涉及文件：** 项目全量初始代码

**具体内容：**
- **功能发布**：包含单张图像处理、比例尺检测、颗粒分割、颗粒标注等核心功能。
- **模型集成**：完成了 YOLO 和 SAM 模型的集成，可进行高效岩石颗粒分割。
- **配置与输出**：支持通过 `config.yaml` 调整模型路径和参数；输出文件含分割图、标注图、CSV 统计数据及 JSON 总结。
- **已知问题**：极端情况下标注重叠；大量图像处理性能待优化；EfficientSAM3 因 Triton 架构限制，对 Windows 端支持较弱。

---

## 2026-01-08

- **修改人：** 系统记录
- **修改类型：** 性能测试
- **涉及文件：** `fastsam_inference_test.py`

**具体内容：**
- 加入 FastSAM 测试脚本。
- **性能评估 (RTX 3060)**：CPU 推理时间约为 GPU 的 4 倍（97.8/405.9/379.5 ms vs 61.1/102.1/68.0 ms）。

---

## 2026-01-09

- **修改人：** 系统记录
- **修改类型：** 性能测试
- **涉及文件：** `mobilesam_inference_test.py`

**具体内容：**
- 加入 MobileSAM 测试脚本。
- **性能评估 (RTX 3060)**：CPU 推理耗时约为 GPU 的 26 倍（CPU 推理环节耗时达 101s，GPU 为 3.7s）。

---

## 2026-01-10

- **修改人：** 李柯然
- **修改类型：** 模型适配与逻辑修改
- **涉及文件：** `rock.py`、`rock_new.py`、`run.py`、`config.yaml`

**具体内容：**
- 在 `rock_new.py` 中适配 MobileSAM 模型，并同步修改了 `run.py` 的调用逻辑。
- 更新了 `config.yaml` 的对应配置参数。

---

## 2026-01-13

- **修改人：** 张立华
- **修改类型：** 文档新增与代码优化
- **涉及文件：** `yolosection.md`、`segmenteverygrain删监督聚类.py` 等

**具体内容：**
- **文档补充**：首次上传 `new` 文件夹的文件说明文档，补充项目文件结构信息。
- **冗余清理**：删除了代码文件中关于“监督聚类”的无用函数。

---

## 2026-01-15

- **修改人：** 张立华、李柯然
- **修改类型：** 同步项目结构
- **涉及文件：** YOLO+SAM 相关代码、YOLO+FastSAM 相关代码

**具体内容：**
- **目录调整**：将 YOLO+SAM 代码移入 `new` 文件夹；YOLO+FastSAM 代码移入 `new/super_fastsam` 子文件夹。

---

## 2026-01-19

- **修改人：** 张立华
- **修改类型：** 代码上传
- **涉及文件：** `fastsam` 文件夹（原 `fsatsam0118`）

**具体内容：**
- 上传并整合截至 1 月 18 日最新的 FastSAM 封装代码。

---

## 2026-01-19

- **修改人：** 李柯然
- **修改类型：** 代码重构与功能增强
- **涉及文件：** `0118fastsam` 文件夹、`run_fastsam.py`、`./geometry/grain_metric.py`、`yolo_fastsam.py`

**具体内容：**
- **结构整合**：封装 FastSAM 为独立文件夹，规范 `run_xxx.py` 脚本放置于根目录，统一输出至 `results` 文件夹。
- **标准化开发**：预留 `mobilesam` 文件夹结构，固定脚本输出格式以适配大语言模型调用。
- **几何计算**：在 `./geometry/grain_metric.py` 中新增多种几何参数计算函数，并适配 `yolo_fastsam.py` 的步骤 7 逻辑。
- **测试**：在 CPU 环境下完成 `Boulder_20260107` 文件夹的测试，效果良好。

---

## 2026-01-21

- **修改人：** 李柯然
- **修改类型：** 参数化功能增强
- **涉及文件：** `geometry_config.yaml`

**具体内容：**
- 增加根据 YAML 配置动态选择几何参数计算项的功能。

---

## 2026-01-22

- **修改人：** 李柯然
- **修改类型：** 配置逻辑优化
- **涉及文件：** `geometry_config.yaml`、`geometry/config_loader.py`、`export_cav.py`、`fastsam/rock_fastsam_system.py`

**具体内容：**
- 优化集合参数配置功能，实现基于 `geometry_config.yaml` 最终确定 CSV 导出字段。

---

## 2026-01-23

- **修改人：** 张立华
- **修改类型：** 模块新增
- **涉及文件：** `/mobilesam` 文件夹、`run_mobilesam.py`

**具体内容：**
- 参照 FastSAM 结构，正式增加并集成了 MobileSAM 处理流。